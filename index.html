<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>For Adinda</title>

<style>
html,body{
  margin:0;
  padding:0;
  background:#000;
  overflow:hidden;
  font-family:Georgia,serif;
}
canvas{position:fixed;inset:0}

#cameraBox{
  position:fixed;
  bottom:12px;right:12px;
  width:110px;aspect-ratio:3/4;
  border-radius:12px;
  overflow:hidden;
  border:1px solid rgba(255,255,255,.35);
  z-index:10;background:#000
}
#cameraBox video{
  width:100%;height:100%;
  object-fit:cover;
  transform:scaleX(-1);
}
#hint{
  position:fixed;
  top:10px;left:50%;
  transform:translateX(-50%);
  color:#fff;opacity:.6;
  font-size:14px;
  z-index:10
}
</style>
</head>

<body>
<div id="hint">Arahkan tangan ke tengah kamera</div>
<div id="cameraBox"><video id="video" autoplay playsinline></video></div>
<canvas id="c"></canvas>

<script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>

<script>
/* ================= CANVAS ================= */
const canvas=c;
const ctx=canvas.getContext("2d");

function resize(){
  canvas.width=innerWidth;
  canvas.height=innerHeight;
  buildTargets();
}
addEventListener("resize",resize);

/* ================= STATE ================= */
let currentState="idle";

/* ================= GALAXY BACKGROUND ================= */
const BG_COUNT=2200;
const bg=[];

for(let i=0;i<BG_COUNT;i++){
  bg.push({
    x:(Math.random()-.5)*innerWidth,
    y:(Math.random()-.5)*innerHeight,
    z:Math.random()*900
  });
}

/* ================= TEXT PARTICLES ================= */
const TEXT_COUNT=3200;
const particles=[];
for(let i=0;i<TEXT_COUNT;i++){
  particles.push({x:0,y:0,z:0});
}

/* ================= MAKE TEXT ================= */
function makeText(text){
  const off=document.createElement("canvas");
  const o=off.getContext("2d");

  off.width=canvas.width;
  off.height=canvas.height;

  const fs=(off.height>off.width?off.width*0.07:off.width*0.045);

  o.fillStyle="#fff";
  o.textAlign="center";
  o.textBaseline="middle";
  o.font=`600 ${fs}px Georgia`;

  const lines=text.split("\n");
  const lh=fs*1.4;
  const sy=off.height/2-(lines.length-1)*lh/2;

  lines.forEach((l,i)=>o.fillText(l,off.width/2,sy+i*lh));

  const d=o.getImageData(0,0,off.width,off.height).data;
  const arr=[],step=2; // lebih rapat → lebih jelas

  for(let y=0;y<off.height;y+=step){
    for(let x=0;x<off.width;x+=step){
      if(d[(y*off.width+x)*4+3]>120){
        arr.push({x:x-off.width/2,y:y-off.height/2,z:0});
      }
    }
  }
  return arr;
}

/* ================= 3D HEART ================= */
function makeHeart3D(){
  const arr=[];
  for(let z=-60;z<=60;z+=6){
    for(let t=0;t<Math.PI*2;t+=0.08){
      const x=16*Math.sin(t)**3;
      const y=13*Math.cos(t)-5*Math.cos(2*t)-2*Math.cos(3*t)-Math.cos(4*t);
      arr.push({x:x*12,y:-y*12,z:z});
    }
  }
  return arr;
}

/* ================= TARGETS ================= */
let TARGETS={};

function buildTargets(){
  TARGETS={
    one: makeText(`Dear Adinda,

I sincerely apologize
for everything that happened.`),

    two: makeText(`I never meant to hurt you,
and I truly regret my mistakes.`),

    three: makeText(`Maafin aku ya sayaangg ♥`),

    four: makeHeart3D(),

    five: makeText(`I'm really sorry, Adinda ♥`)
  };
}

/* ================= ANIMATE ================= */
let t=0;

function drawGalaxy(){
  bg.forEach(p=>{
    p.z-=0.3;
    if(p.z<1) p.z=900;

    const s=650/(650+p.z);
    const x=p.x*s+canvas.width/2;
    const y=p.y*s+canvas.height/2;

    ctx.fillStyle=`rgba(120,80,255,0.6)`;
    ctx.fillRect(x,y,1.2*s,1.2*s);
  });
}

function animate(){
  t+=0.01;
  ctx.clearRect(0,0,canvas.width,canvas.height);

  drawGalaxy();

  const target=TARGETS[currentState];
  if(!target) return requestAnimationFrame(animate);

  target.forEach((pt,i)=>{
    const p=particles[i]||(particles[i]={x:0,y:0,z:0});

    // rotasi 3D khusus heart
    let tx=pt.x, ty=pt.y, tz=pt.z;

    if(currentState==="four"){
      const ang=t*0.6;
      const cos=Math.cos(ang);
      const sin=Math.sin(ang);
      const nx=tx*cos - tz*sin;
      const nz=tx*sin + tz*cos;
      tx=nx; tz=nz;
    }

    p.x+=(tx-p.x)*0.08;
    p.y+=(ty-p.y)*0.08;
    p.z+=(tz-p.z)*0.08;

    const s=650/(650+p.z);

    ctx.beginPath();
    ctx.arc(canvas.width/2+p.x*s,canvas.height/2+p.y*s,2*s,0,Math.PI*2);

    // glow lembut agar teks jelas
    const glow=ctx.createRadialGradient(
      canvas.width/2+p.x*s,
      canvas.height/2+p.y*s,
      0,
      canvas.width/2+p.x*s,
      canvas.height/2+p.y*s,
      6*s
    );
    glow.addColorStop(0,"rgba(255,200,255,1)");
    glow.addColorStop(1,"rgba(120,80,255,0)");

    ctx.fillStyle=glow;
    ctx.fill();
  });

  requestAnimationFrame(animate);
}

/* ================= MEDIAPIPE ================= */
const video=document.getElementById("video");

const hands=new Hands({locateFile:f=>`https://cdn.jsdelivr.net/npm/@mediapipe/hands/${f}`});

hands.setOptions({
  maxNumHands:1,
  minDetectionConfidence:0.6,
  minTrackingConfidence:0.6
});

hands.onResults(res=>{
  if(!res.multiHandLandmarks || res.multiHandLandmarks.length===0){
    currentState="idle";
    return;
  }

  const lm=res.multiHandLandmarks[0];
  if(!lm || lm.length<21){currentState="idle";return;}

  let fingers=0;
  [8,12,16,20].forEach(t=>{ if(lm[t].y<lm[t-2].y) fingers++; });
  if(lm[4].x<lm[3].x) fingers++;

  currentState=["idle","one","two","three","four","five"][fingers]||"idle";
});

const camera=new Camera(video,{
  onFrame:async()=>hands.send({image:video}),
  width:360,height:480
});

/* ================= START ================= */
resize();
animate();
camera.start();
</script>
</body>
</html>
